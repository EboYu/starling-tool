// CLH lock module

struct Node {
  var lock: Bool;
  var pred: Node;
}

predicate CLHfoot(Foot: Set<Node>, head: Node, tail: Node) 
  requires acc(Foot)
{ 
  exists Queue : Set<Node> :: ( 
    Queue = { z : Node :: z in Foot && z != head && Btwn(pred,tail,z,head) } 
    &&
    Btwn(pred, tail, head, head)
    &&
    head in Foot
    &&
    (forall x : Node :: (x in Queue && x != head) ==> x.lock)
    &&
    (forall x : Node :: (x.lock && x.pred != null) ==> x in Queue)
  ) 
} 
